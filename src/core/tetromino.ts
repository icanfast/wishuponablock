import type { PieceKind, Rotation, Vec2 } from './types';

export type CellOffset = Vec2;

// Offsets inside a 4x4 box; piece position (x,y) is top-left of the 4x4.
export const TETROMINOES: Record<
  PieceKind,
  readonly (readonly CellOffset[])[]
> = {
  I: [
    [
      [0, 1],
      [1, 1],
      [2, 1],
      [3, 1],
    ],
    [
      [2, 0],
      [2, 1],
      [2, 2],
      [2, 3],
    ],
    [
      [0, 2],
      [1, 2],
      [2, 2],
      [3, 2],
    ],
    [
      [1, 0],
      [1, 1],
      [1, 2],
      [1, 3],
    ],
  ],
  O: [
    [
      [1, 1],
      [2, 1],
      [1, 2],
      [2, 2],
    ],
    [
      [1, 1],
      [2, 1],
      [1, 2],
      [2, 2],
    ],
    [
      [1, 1],
      [2, 1],
      [1, 2],
      [2, 2],
    ],
    [
      [1, 1],
      [2, 1],
      [1, 2],
      [2, 2],
    ],
  ],
  T: [
    [
      [1, 1],
      [0, 2],
      [1, 2],
      [2, 2],
    ],
    [
      [1, 1],
      [1, 2],
      [2, 2],
      [1, 3],
    ],
    [
      [0, 2],
      [1, 2],
      [2, 2],
      [1, 3],
    ],
    [
      [1, 1],
      [0, 2],
      [1, 2],
      [1, 3],
    ],
  ],
  S: [
    [
      [1, 1],
      [2, 1],
      [0, 2],
      [1, 2],
    ],
    [
      [1, 1],
      [1, 2],
      [2, 2],
      [2, 3],
    ],
    [
      [1, 2],
      [2, 2],
      [0, 3],
      [1, 3],
    ],
    [
      [0, 1],
      [0, 2],
      [1, 2],
      [1, 3],
    ],
  ],
  Z: [
    [
      [0, 1],
      [1, 1],
      [1, 2],
      [2, 2],
    ],
    [
      [2, 1],
      [1, 2],
      [2, 2],
      [1, 3],
    ],
    [
      [0, 2],
      [1, 2],
      [1, 3],
      [2, 3],
    ],
    [
      [1, 1],
      [0, 2],
      [1, 2],
      [0, 3],
    ],
  ],
  J: [
    [
      [0, 1],
      [0, 2],
      [1, 2],
      [2, 2],
    ],
    [
      [1, 1],
      [2, 1],
      [1, 2],
      [1, 3],
    ],
    [
      [0, 2],
      [1, 2],
      [2, 2],
      [2, 3],
    ],
    [
      [1, 1],
      [1, 2],
      [0, 3],
      [1, 3],
    ],
  ],
  L: [
    [
      [2, 1],
      [0, 2],
      [1, 2],
      [2, 2],
    ],
    [
      [1, 1],
      [1, 2],
      [1, 3],
      [2, 3],
    ],
    [
      [0, 2],
      [1, 2],
      [2, 2],
      [0, 3],
    ],
    [
      [0, 1],
      [1, 1],
      [1, 2],
      [1, 3],
    ],
  ],
} as const;

export function rotAdd(r: Rotation, delta: -1 | 1): Rotation {
  const v = (r + (delta === 1 ? 1 : 3)) % 4;
  return v as Rotation;
}
